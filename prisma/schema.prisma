// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(cuid())
  email         String         @unique
  password      String
  name          String
  role          String         @default("USER") // "USER" or "ADMIN"
  isApproved    Boolean        @default(true)   // Default true to allow initial setup, logic will handle "require approval" check
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  
  // Doctor Details (Defaults)
  qualifications String?
  specialty      String?
  registrationId String?
  logoUrl        String?
  
  // Default Patient Details (for autofill)
  defaultPatientAge    Int?
  defaultPatientGender String?
  defaultPatientHeight Int?
  defaultPatientWeight Int?
  

  
  prescriptions Prescription[]
}

model SystemSettings {
  key         String  @id
  value       String  // JSON string or simple value
  description String?
}

model Prescription {
  id                 String     @id @default(cuid())
  userId             String
  user               User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  rxId               String     @unique @default(cuid())
  status             String     @default("DRAFT") // DRAFT or PUBLISHED
  
  // Patient Information
  patientName        String
  patientId          String?
  patientAge         Int?
  patientGender      String?
  patientHeight      Int?       // in cms
  patientWeight      Int?       // in kgs
  
  // Doctor Information (Snapshot)
  doctorName         String?
  doctorQualifications String?
  doctorRegId        String?
  prescriptionDate   DateTime   @default(now())
  
  // Diagnosis
  diagnosis          String?
  diagnosisCode      String?    // ICD Code like 5B57.Z
  description        String?
  additionalComments String?
  
  // Additional Information
  drugAllergies      String?
  labTests           String?
  followUp           String?
  doctorAdvice       String?
  
  // Timestamps
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  
  // Relations
  medicines          Medicine[]
}

model Medicine {
  id             String       @id @default(cuid())
  prescriptionId String
  prescription   Prescription @relation(fields: [prescriptionId], references: [id], onDelete: Cascade)
  serialNo       Int
  name           String
  dosage         String?
  instructions   String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
}
